 <!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
      <title>WhatApp</title>
      <!-- Bootstrap -->
      <link href="css/bootstrap.min.css" rel="stylesheet">
      <!-- CUSTOM CSS -->
      <link rel="stylesheet" type="text/css" href="css/style.css">
   </head>
   <body>
<!-- =========================================================================================== -->
      <!--MAIN CONTAINER-->
      <div class="block">

<!-- =========================================================================================== -->
<!-- *************************************** HEADER ******************************************** -->
<!-- =========================================================================================== -->
         <!--HEADER PARENT-->
         <div class="block green">
         <!--HEADER CONTAINER-->
            <div class="app-container">

            <!--HEADER-->
               <div class="header f50 clearfix">
                  <div class="whatsapp"><p>WhatsApp</p></div>
                  <div class="icons">
                     <i class="glyphicon glyphicon-search icon_child" aria-hidden="true"></i>
                     <i class="glyphicon glyphicon-option-vertical icon_child" aria-hidden="true"></i>
                  </div>
               </div>
            <!--HEADER-->

            <!--NAVIGATION-->
               <div class="navigation clearfix">
                  <div class="chats center border-bottom">
                     <p class="">CHATS</p>
                  </div>
                  <div class="users center">
                     <p class="">USERS</p>
                  </div>
               </div>
            <!--NAVIGATION-->

            </div>
         <!--HEADER CONTAINER-->
         </div>
         <!--HEADER PARENT-->
<!-- =========================================================================================== -->
<!-- ************************************ SECTION - 1 ****************************************** -->
<!-- =========================================================================================== -->
         <!--USER PARENT-->
         <div class="block section1">
            <!--USER CONTAINER-->
            <div class="app-container">

              <!--USER-->
               <div class="user clearfix" id="profile">

               </div>
              <!--USER-->

            </div>
            <!--USER CONTAINER-->
         </div>
         <!--USER PARENT-->
<!-- =========================================================================================== -->
<!-- ************************************ SECTION - 2 ****************************************** -->
<!-- =========================================================================================== -->
        <div class="section2">

          <div class="userInfoheader" id = "next">
            
          </div>
         <!--CHATBOX PARENT-->
         <div class="block chatbox_parent" id="messages">
           
         </div>
         <!--CHATBOX PARENT-->

         <!--INPUT-TEXTBOX PARENT-->
         <div class="block">

         <form>
            <div class="inputBox" id="m">
               <div class="input_parent"><input type="text" name="fname" class="input" autocomplete="off"> </div>
              <div class="send"> <button> <img src="images/send.png"></button></div>
              
            </div>
            </form>
         </div>
         <!--INPUT-TEXTBOX PARENT-->

         </div>
<!-- =========================================================================================== -->
<!-- =========================================================================================== -->
     
      </div>
      <!--MAIN CONTAINER-->

<!-- =========================================================================================== --> 
      <!-- JS -->

     <script src="/socket.io/socket.io.js"></script>
      <!-- jQuery -->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
      <script>
         $(function () {
           var socket = io();
            socket.on('connect', function () {
            // var id =self.io.managers[Object.keys(self.io.managers)].connecting[0].id;

              // FETCHING JSON DATA
                  $.getJSON('data.json', function(ids){
                    // STORING JSON DATA TO LOCAL STORAGE
                      console.log(ids);
                   localStorage.setItem('ids', JSON.stringify(ids));
                   var userId = JSON.parse(localStorage.getItem('ids')); 

                   // EVENT LISTENER FOR UPDATE IN LOCAL STORAGE(ADDITTION OF A NEW MEMBER)
                    window.addEventListener('storage', function(data) {
                      var newUser =  JSON.parse(data.newValue);
                      console.log(data.newValue);
                      //debugger;
                // APPENDIND THE NEW DATA/PROFILES TO HTML
                if(newUser.length != userId.length){
                for(i=newUser.length-1; i<newUser.length; i++){
                 // to add profiles
                  $("#profile").append("<div class='clearfix' id ="+newUser[i].id+" onclick='chatTab(this.id)'><div class='picture'><img src='images/profilePicture_sm.jpg' alt='' /></div><div class='content'><h2 class='name heading_color P_M0'>" + newUser[i].id  + "</h2><p class='status text_color P_M0'>Hey there! I am using WhatsApp.</p> </div></div>");
                 }

                }
                    });

                 for(i=0; i<userId.length; i++){
                 // to add profiles
                  $( "#profile").append("<div class='clearfix' id ="+userId[i].id+"  onclick='chatTab(this.id)'><div class='picture'><img src='images/profilePicture_sm.jpg' alt='' /></div><div class='content'><h2 class='name heading_color P_M0'>" + userId[i].id + "</h2><p class='status text_color P_M0'>Hey there! I am using WhatsApp.</p> </div></div>");
                 }

                   });

                  });
          // SUBMITTING MESSAGES TEXT
           $('form').submit(function(){
             socket.emit('chat message', $('#m .input_parent input').val());
             $('#m .input_parent input').val('');
             return false;
           });


           // to add messages
           socket.on('chat message', function(msg){
             $( "#messages").append( "<div class='chatbox'><img src='images/sidecopy.png'><p class='addText'>"+ msg +"</p></div>");
             //console.log(localStorage.ids);
           });
          // var check = JSON.parse(localStorage.ids);
          // console.log(check[check.length-1].id);
         // socket.to(check[check.length-1].id).emit('hey', 'I just met you');
          // console.log(idArray);
         });


     </script>
      <script src="js/script.js" type="text/javascript"></script>
      <script src="data.json" type="text/javascript"></script>
      <!-- Include all compiled plugins (below), or include individual files as needed -->
      <script src="js/bootstrap.min.js"></script>

   </body>
</html>